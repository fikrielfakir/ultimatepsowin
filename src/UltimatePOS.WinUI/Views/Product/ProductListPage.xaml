<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="UltimatePOS.WinUI.Views.Product.ProductListPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,24">
            <TextBlock Text="Products" Style="{StaticResource TitleTextBlockStyle}" Margin="0,0,0,8"/>
            <TextBlock Text="Manage your product inventory" Style="{StaticResource BodyTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
        </StackPanel>

        <!-- Search and Filter Bar -->
        <Grid Grid.Row="1"  Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                <!-- Search Box -->
                <AutoSuggestBox
                    PlaceholderText="Search products..."
                    QueryIcon="Find"
                    Text="{x:Bind ViewModel.SearchTerm, Mode=TwoWay}"
                    Width="300"/>

                <Button Content="Search" Command="{x:Bind ViewModel.SearchCommand}"/>

                <!-- Category Filter -->
                <ComboBox
                    PlaceholderText="Category"
                    ItemsSource="{x:Bind ViewModel.Categories}"
                    SelectedItem="{x:Bind ViewModel.SelectedCategoryId, Mode=TwoWay}"
                    DisplayMemberPath="Name"
                    SelectedValuePath="Id"
                    MinWidth="150"/>

                <!-- Brand Filter -->
                <ComboBox
                    PlaceholderText="Brand"
                    ItemsSource="{x:Bind ViewModel.Brands}"
                    SelectedItem="{x:Bind ViewModel.SelectedBrandId, Mode=TwoWay}"
                    DisplayMemberPath="Name"
                    SelectedValuePath="Id"
                    MinWidth="150"/>

                <Button Content="Clear Filters" Command="{x:Bind ViewModel.ClearFiltersCommand}"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                <Button Content="Refresh" Command="{x:Bind ViewModel.RefreshCommand}">
                    <Button.KeyboardAccelerators>
                        <KeyboardAccelerator Key="F5"/>
                    </Button.KeyboardAccelerators>
                </Button>
                <Button Content="Print Labels" Command="{x:Bind ViewModel.BulkPrintCommand}">
                    <Button.KeyboardAccelerators>
                        <KeyboardAccelerator Key="P" Modifiers="Control"/>
                    </Button.KeyboardAccelerators>
                </Button>
                <Button Content="Add Product" Command="{x:Bind ViewModel.AddProductCommand}" Style="{StaticResource AccentButtonStyle}">
                    <Button.KeyboardAccelerators>
                        <KeyboardAccelerator Key="N" Modifiers="Control"/>
                    </Button.KeyboardAccelerators>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Product List -->
        <ScrollViewer Grid.Row="2">
            <StackPanel>
                <ProgressBar IsIndeterminate="True" Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay}"/>

                <ListView
                    ItemsSource="{x:Bind ViewModel.Products, Mode=OneWay}"
                    SelectedItem="{x:Bind ViewModel.SelectedProduct, Mode=TwoWay}"
                    SelectionMode="Single"
                    Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">

                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="local:Product">
                            <Grid Padding="12" Margin="0,0,0,8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="4">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Stock Alert Indicator -->
                                <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" 
                                        Width="4" 
                                        CornerRadius="2" 
                                        Margin="0,0,12,0"
                                        Background="{ThemeResource SystemFillColorCriticalBrush}"
                                        Visibility="{Binding AlertQuantity, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}"/>

                                <!-- Product Info -->
                                <StackPanel Grid.Row="0" Grid.Column="1">
                                    <TextBlock Text="{x:Bind Name}" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                    <TextBlock Text="{x:Bind SKU}" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>

                                <!-- Category/Brand -->
                                <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="0,4,0,0">
                                    <TextBlock Text="{x:Bind Category.Name}" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="•" Style="{StaticResource CaptionTextBlockStyle}"/>
                                    <TextBlock Text="{x:Bind Brand.Name}" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>

                                <!-- Pricing -->
                                <StackPanel Grid.Row="0" Grid.Column="2" Margin="16,0,0,0">
                                    <TextBlock Text="Cost" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="{x:Bind CostPrice}" Style="{StaticResource BodyTextBlockStyle}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="0" Grid.Column="3" Margin="16,0,0,0">
                                    <TextBlock Text="Selling" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="{x:Bind SellingPrice}" Style="{StaticResource BodyTextBlockStyle}"/>
                                </StackPanel>

                                <!-- Actions -->
                                <StackPanel Grid.Row="0" Grid.RowSpan="2" Grid.Column="4" Orientation="Horizontal" Spacing="4" Margin="16,0,0,0" VerticalAlignment="Center">
                                    <Button Content="Edit" Command="{Binding DataContext.EditProductCommand, ElementName=Page}" CommandParameter="{x:Bind}"/>
                                    <Button Content="Delete" Command="{Binding DataContext.DeleteProductCommand, ElementName=Page}" CommandParameter="{x:Bind}"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <!-- Empty State -->
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="8" Visibility="{x:Bind ViewModel.HasNoProducts, Mode=OneWay}">
                    <TextBlock Text="No products found" Style="{StaticResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                    <TextBlock Text="Add your first product to get started" Style="{StaticResource BodyTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>

        <!-- Pagination -->
        <Grid Grid.Row="3" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" VerticalAlignment="Center">
                <Run Text="Page"/>
                <Run Text="{x:Bind ViewModel.CurrentPage, Mode=OneWay}"/>
                <Run Text="of"/>
                <Run Text="{x:Bind ViewModel.TotalPages, Mode=OneWay}"/>
                <Run Text="•"/>
                <Run Text="{x:Bind ViewModel.TotalCount, Mode=OneWay}"/>
                <Run Text="total"/>
            </TextBlock>

            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                <Button Content="Previous" Command="{x:Bind ViewModel.PreviousPageCommand}" IsEnabled="{x:Bind ViewModel.HasPreviousPage, Mode=OneWay}"/>
                <Button Content="Next" Command="{x:Bind ViewModel.NextPageCommand}" IsEnabled="{x:Bind ViewModel.HasNextPage, Mode=OneWay}"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
